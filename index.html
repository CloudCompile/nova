<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nova â€” Your AI Assistant</title>
  <style>
    /* Same styles as before */
    body {
      font-family: 'Google Sans', Roboto, Arial, sans-serif;
      background: #f2f2f2;
      color: #202124;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px;
    }
    h1 {
      font-size: 2rem;
    }
    input, button {
      padding: 10px;
      font-size: 1rem;
      margin: 10px;
      border-radius: 20px;
      border: none;
      outline: none;
    }
    input {
      width: 60%;
      max-width: 400px;
      background: #fff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    button {
      background-color: #1a73e8;
      color: white;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background-color: #155ab6;
    }
    #responseBox {
      margin-top: 20px;
      padding: 20px;
      background: #fff;
      border-radius: 16px;
      max-width: 600px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-align: left;
    }
    #featureToggle {
      display: flex;
      flex-direction: column;
      margin-top: 20px;
    }
    #featureToggle label {
      font-size: 1rem;
      margin-bottom: 5px;
    }
    #featureToggle input {
      margin-bottom: 10px;
    }
    .feature-box {
      background-color: #fff;
      padding: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      border-radius: 10px;
      width: 80%;
      max-width: 600px;
    }
  </style>
</head>
<body>
  <h1>Meet <span style="color:#1a73e8;">Nova</span></h1>

  <input id="userInput" placeholder="Ask me something..." size="50"/>
  <button onclick="handleAsk()">Ask</button>
  <span id="microphoneIcon" onclick="startListening()">ðŸŽ¤</span>

  <!-- API Key Inputs and Feature Toggles -->
  <div class="feature-box">
    <h2>Enable Features</h2>
    <div id="featureToggle">
      <label>Weather API Key:</label>
      <input type="text" id="weatherApiKey" placeholder="Enter your weather API key" />
      <label>News API Key:</label>
      <input type="text" id="newsApiKey" placeholder="Enter your news API key" />
      <label>Enable Weather:</label>
      <input type="checkbox" id="weatherToggle" />
      <label>Enable News:</label>
      <input type="checkbox" id="newsToggle" />
    </div>
  </div>

  <div id="responseBox"></div>

  <script>
    const apiKey = "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";
    let weatherApiKey = "";
    let newsApiKey = "";
    let weatherEnabled = false;
    let newsEnabled = false;

    // Handle user input and process API call
    async function askAI(prompt) {
      try {
        const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${apiKey}`,
            "Content-Type": "application/json",
            "HTTP-Referer": "http://localhost",
            "X-Title": "Nova AI"
          },
          body: JSON.stringify({
            model: "mistralai/mistral-7b-instruct:free",
            messages: [
              {
                role: "system",
                content: "You are Nova, a calm, friendly, and smart AI assistant. You answer clearly, helpfully, and with a laid-back tone."
              },
              { role: "user", content: prompt }
            ]
          })
        });

        const data = await response.json();
        if (data.error) {
          displayResponse(`Error from AI: ${data.error.message}`);
          return;
        }

        const reply = data.choices?.[0]?.message?.content || "Hmm... no response ðŸ¤”";

        // Check if user enabled weather or news
        if (weatherEnabled) {
          const weatherReply = await fetchWeather();
          reply += weatherReply;
        }
        if (newsEnabled) {
          const newsReply = await fetchNews();
          reply += newsReply;
        }

        speak(reply);
        displayResponse(reply);
        return reply;
      } catch (error) {
        displayResponse(`Error: ${error.message}`);
      }
    }

    // Fetch weather data
    async function fetchWeather() {
      if (!weatherApiKey) {
        displayResponse("You need to enter a Weather API key!");
        return;
      }
      try {
        const weatherResponse = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=London&appid=${weatherApiKey}`);
        const weatherData = await weatherResponse.json();
        
        if (weatherData.cod !== 200) {
          displayResponse("Unable to fetch weather data.");
          return;
        }

        return `\nWeather: ${weatherData.weather[0].description}, Temperature: ${Math.round(weatherData.main.temp - 273.15)}Â°C`;
      } catch (error) {
        displayResponse(`Weather API Error: ${error.message}`);
        return;
      }
    }

    // Fetch news data
    async function fetchNews() {
      if (!newsApiKey) {
        displayResponse("You need to enter a News API key!");
        return;
      }
      try {
        const newsResponse = await fetch(`https://newsapi.org/v2/top-headlines?country=us&apiKey=${newsApiKey}`);
        const newsData = await newsResponse.json();
        
        if (newsData.status !== "ok") {
          displayResponse("Unable to fetch news.");
          return;
        }

        const articles = newsData.articles.slice(0, 3);
        let newsSummary = "\nTop News:\n";
        articles.forEach((article, index) => {
          newsSummary += `${index + 1}. ${article.title}\n`;
        });

        return newsSummary;
      } catch (error) {
        displayResponse(`News API Error: ${error.message}`);
        return;
      }
    }

    // Handle feature toggles
    document.getElementById("weatherToggle").addEventListener("change", (e) => {
      weatherEnabled = e.target.checked;
    });

    document.getElementById("newsToggle").addEventListener("change", (e) => {
      newsEnabled = e.target.checked;
    });

    // Handle user input and show response
    async function handleAsk() {
      const input = document.getElementById("userInput").value;
      if (!input.trim()) return;

      displayResponse("Thinking...");
      const reply = await askAI(input);
      displayResponse(reply);
    }

    // Display response on the screen
    function displayResponse(message) {
      document.getElementById("responseBox").innerText = message;
    }

    // Text-to-speech function
    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      const voices = speechSynthesis.getVoices();
      utterance.voice = voices.find(v => v.name.includes("Google") || v.default) || null;
      speechSynthesis.speak(utterance);
    }

    // Start listening for speech commands
    function startListening() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        displayResponse("Speech recognition not supported ðŸ˜¢");
        return;
      }

      const recognition = new SpeechRecognition();
      recognition.lang = "en-US";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.start();
      recognition.onresult = async (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById("userInput").value = transcript;
        handleAsk();
      };

      recognition.onerror = (event) => {
        displayResponse("Error with speech recognition: " + event.error);
      };
    }
  </script>
</body>
</html>
